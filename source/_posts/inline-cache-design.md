---
title: inline_cache_design
categories:
  - vm
tags:
  - vm
date: 2025-03-21 23:33:24
---

## 背景

动态语言的符号绑定是动态的，会随着程序的执行而发生变化，因此，在程序执行过程中需要先获取符号的地址，才能执行符号对应的代码。这相比静态语言程序执行多了符号查找的开销，因为静态语言的符号都在编译时静态绑定了，所以它可以在程序执行过程中直接执行符号对应的代码。这也是许多动态语言性能不如静态语言的原因之一。（如下例子）

为什么动态语言的符号绑定是动态的呢？有个原因是因为动态语言的对象类型是动态的，导致在运行之前无法根据类型确定对象的布局，从而无法确定符号的地址。但是为了提高动态语言的性能，有需要尽可能地降低这些符号绑定的开销。因此，人们根据局部性原理提出了一些投机和缓存的算法，其中一个称为in-line cache。这个优化是在动态语言的执行环境里实现的，一般称为虚拟机或执行引擎。

本文下面基于QuickJS这个Javascript的虚拟机，描述如何在虚拟机里实现in-line cache优化算法。首先介绍下QuickJS基本情况和in-line cache基本概念，然后介绍下in-line cache实现的概要设计和详细设计，最后给出测试数据和结论。

<!-- more -->

## 现状

### QuickJS

### in-line cache

